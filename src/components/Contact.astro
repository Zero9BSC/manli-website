---
// import SocialLinks from './SocialLinks.astro'; // Oculto hasta implementar redes (Facebook, Instagram, LinkedIn)
// const tel = '2804601630'; // Oculto hasta implementar teléfono
// const telLink = 'tel:+542804601630';
const email = 'manlisas.001@gmail.com';
const mapsQuery = encodeURIComponent('Puerto Madryn, Chubut, Argentina');
const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${mapsQuery}`;
const formAction = 'https://formspree.io/f/xgoabzoo';
---

<section id="contacto" class="bg-slate-50 px-4 py-16 sm:py-24">
  <div class="mx-auto max-w-6xl">
    <div class="mx-auto max-w-2xl text-center">
      <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Contacto</h2>
      <p class="mt-4 text-lg text-slate-600">
        Envíenos su consulta por el formulario a manlisas.001@gmail.com.
      </p>
    </div>

    <div class="mt-16 grid gap-12 lg:grid-cols-2">
      <!-- Formulario -->
      <div class="rounded-2xl border border-slate-200 bg-white p-8 shadow-sm">
        <h3 class="text-xl font-semibold text-slate-900">Enviar mensaje</h3>

        <div id="contact-form-success" class="mt-6 hidden rounded-xl border border-manli-green-200 bg-manli-green-50 p-6 text-center" role="alert">
          <p class="font-semibold text-manli-green-800">¡Gracias!</p>
          <p class="mt-1 text-manli-green-700">El formulario ha sido enviado con éxito. Nos pondremos en contacto a la brevedad.</p>
        </div>

        <form
          action={formAction}
          method="POST"
          class="mt-6 space-y-5"
          id="contact-form"
        >
          <input type="hidden" name="_subject" value="Nueva consulta — MANLI S.A.S." />
          <div>
            <label for="name" class="block text-sm font-medium text-slate-700">Nombre</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              autocomplete="name"
              class="mt-1 block w-full rounded-lg border border-slate-300 px-4 py-3 text-slate-900 shadow-sm focus:border-manli-green-500 focus:outline-none focus:ring-2 focus:ring-manli-green-500/50"
              placeholder="Su nombre"
            />
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-slate-700">Correo electrónico</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              class="mt-1 block w-full rounded-lg border border-slate-300 px-4 py-3 text-slate-900 shadow-sm focus:border-manli-green-500 focus:outline-none focus:ring-2 focus:ring-manli-green-500/50"
              placeholder="ejemplo@correo.com"
            />
          </div>
          <div>
            <label for="message" class="block text-sm font-medium text-slate-700">Mensaje</label>
            <textarea
              id="message"
              name="message"
              rows="4"
              required
              class="mt-1 block w-full rounded-lg border border-slate-300 px-4 py-3 text-slate-900 shadow-sm focus:border-manli-green-500 focus:outline-none focus:ring-2 focus:ring-manli-green-500/50"
              placeholder="Cuéntanos en qué podemos ayudarte."
            ></textarea>
          </div>
          <div id="contact-form-error" class="hidden rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700" role="alert">
            Hubo un error al enviar. Por favor intente de nuevo o contáctenos por correo.
          </div>
          <div>
            <button
              type="submit"
              id="contact-form-submit"
              class="w-full rounded-xl bg-manli-green-600 px-6 py-4 font-semibold text-white shadow transition hover:bg-manli-green-700 focus:outline-none focus:ring-2 focus:ring-manli-green-500 focus:ring-offset-2 disabled:opacity-70"
            >
              Enviar mensaje
            </button>
          </div>
        </form>
      </div>

      <!-- Datos de contacto -->
      <div class="flex flex-col justify-center space-y-8">
        <div>
          <h3 class="text-xl font-semibold text-slate-900">Datos de contacto</h3>
          <ul class="mt-6 space-y-5" role="list">
            <li class="flex items-start gap-4">
              <span class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-manli-blue-100 text-manli-blue-600">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </span>
              <div>
                <p class="font-medium text-slate-900">Correo electrónico</p>
                <a href={`mailto:${email}`} class="text-manli-green-600 hover:underline">{email}</a>
              </div>
            </li>
            <!-- Teléfono oculto hasta implementar
            <li class="flex items-start gap-4">
              <span class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-manli-green-100 text-manli-green-600">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
              </span>
              <div>
                <p class="font-medium text-slate-900">Teléfono</p>
                <a href={telLink} class="text-manli-green-600 hover:underline">{tel}</a>
              </div>
            </li>
            -->
            <li class="flex items-start gap-4">
              <span class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-manli-blue-100 text-manli-blue-600">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </span>
              <div>
                <p class="font-medium text-slate-900">Ubicación</p>
                <a href={mapsUrl} target="_blank" rel="noopener noreferrer" class="text-manli-green-600 hover:underline">Puerto Madryn, Chubut, Argentina</a>
              </div>
            </li>
          </ul>
        </div>
        <!-- <SocialLinks /> -->
      </div>
    </div>
  </div>
</section>

<script define:vars={{ formAction }}>
  const form = document.getElementById('contact-form');
  const successEl = document.getElementById('contact-form-success');
  const errorEl = document.getElementById('contact-form-error');
  const submitBtn = document.getElementById('contact-form-submit');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorEl?.classList.add('hidden');
    if (submitBtn) submitBtn.disabled = true;

    try {
      const res = await fetch(formAction, {
        method: 'POST',
        body: new FormData(form),
        headers: { Accept: 'application/json' },
      });

      if (res.ok) {
        form.classList.add('hidden');
        successEl?.classList.remove('hidden');
        form.reset();
      } else {
        const data = await res.json().catch(() => ({}));
        const msg = data.error || 'Error al enviar';
        if (errorEl) {
          errorEl.textContent = msg;
          errorEl.classList.remove('hidden');
        }
      }
    } catch {
      if (errorEl) {
        errorEl.textContent = 'Hubo un error al enviar. Por favor intente de nuevo o contáctenos por correo.';
        errorEl.classList.remove('hidden');
      }
    } finally {
      if (submitBtn) submitBtn.disabled = false;
    }
  });
</script>
